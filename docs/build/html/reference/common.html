

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Common submodule &mdash; Rainforest QPE library  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Examples" href="../examples.html" />
    <link rel="prev" title="rainforest.ml package" href="rainforest.ml.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Rainforest QPE library
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../usage.html#access-library">Access library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage.html#keeping-database-up-to-date">Keeping database up-to-date</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage.html#keeping-randomforest-model-up-to-date">Keeping randomForest model up-to-date</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="interface.html">Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="qpe.html">QPE submodule</a><ul>
<li class="toctree-l3"><a class="reference internal" href="qpe_cmd.html">QPE command-line tools</a><ul>
<li class="toctree-l4"><a class="reference internal" href="qpe_cmd.html#qpe-compute"><em>qpe_compute</em></a></li>
<li class="toctree-l4"><a class="reference internal" href="qpe_cmd.html#qpe-plot"><em>qpe_plot</em></a></li>
<li class="toctree-l4"><a class="reference internal" href="qpe_cmd.html#qpe-evaluation"><em>qpe_evaluation</em></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="rainforest.qpe.html">rainforest.qpe package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="rainforest.qpe.html#module-rainforest.qpe.evaluation">rainforest.qpe.evaluation module</a></li>
<li class="toctree-l4"><a class="reference internal" href="rainforest.qpe.html#module-rainforest.qpe.qpe">rainforest.qpe.qpe module</a></li>
<li class="toctree-l4"><a class="reference internal" href="rainforest.qpe.html#module-rainforest.qpe.qpe_compute">rainforest.qpe.qpe_compute module</a></li>
<li class="toctree-l4"><a class="reference internal" href="rainforest.qpe.html#module-rainforest.qpe.qpe_evaluation">rainforest.qpe.qpe_evaluation module</a></li>
<li class="toctree-l4"><a class="reference internal" href="rainforest.qpe.html#module-rainforest.qpe.qpe_plot">rainforest.qpe.qpe_plot module</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="db.html">Database submodule</a><ul>
<li class="toctree-l3"><a class="reference internal" href="db_structure.html">Database structure</a><ul>
<li class="toctree-l4"><a class="reference internal" href="db_structure.html#gauge-table"><em>Gauge table</em></a></li>
<li class="toctree-l4"><a class="reference internal" href="db_structure.html#reference-table"><em>Reference table</em></a></li>
<li class="toctree-l4"><a class="reference internal" href="db_structure.html#radar-table"><em>Radar table</em></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="db_options.html">Database configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="db_cmd.html">Database command-line tool</a><ul>
<li class="toctree-l4"><a class="reference internal" href="db_cmd.html#db-populate"><em>db_populate</em></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="rainforest.database.html">rainforest.database package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="rainforest.database.html#module-rainforest.database.database">rainforest.database.database module</a></li>
<li class="toctree-l4"><a class="reference internal" href="rainforest.database.html#module-rainforest.database.db_populate">rainforest.database.db_populate module</a></li>
<li class="toctree-l4"><a class="reference internal" href="rainforest.database.html#module-rainforest.database.retrieve_radar_data">rainforest.database.retrieve_radar_data module</a></li>
<li class="toctree-l4"><a class="reference internal" href="rainforest.database.html#module-rainforest.database.retrieve_reference_data">rainforest.database.retrieve_reference_data module</a></li>
<li class="toctree-l4"><a class="reference internal" href="rainforest.database.html#rainforest-database-retrieve-dwh-data-r-module">rainforest.database.retrieve_dwh_data R module</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ml.html">ML submodule</a><ul>
<li class="toctree-l3"><a class="reference internal" href="ml_cmd.html">Machine-learning command-line tool</a><ul>
<li class="toctree-l4"><a class="reference internal" href="ml_cmd.html#rf-train"><em>rf_train</em></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="rainforest.ml.html">rainforest.ml package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="rainforest.ml.html#module-rainforest.ml.rf">rainforest.ml.rf module</a></li>
<li class="toctree-l4"><a class="reference internal" href="rainforest.ml.html#module-rainforest.ml.rf_train">rainforest.ml.rf_train module</a></li>
<li class="toctree-l4"><a class="reference internal" href="rainforest.ml.html#module-rainforest.ml.rfdefinitions">rainforest.ml.rfdefinitions module</a></li>
<li class="toctree-l4"><a class="reference internal" href="rainforest.ml.html#module-rainforest.ml.utils">rainforest.ml.utils module</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Common submodule</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#module-rainforest.common.io_data">rainforest.common.io_data module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-rainforest.common.retrieve_data">rainforest.common.retrieve_data module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-rainforest.common.radarprocessing">rainforest.common.radarprocessing module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-rainforest.common.constants">rainforest.common.constants module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-rainforest.common.graphics">rainforest.common.graphics module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-rainforest.common.lookup">rainforest.common.lookup module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-rainforest.common.utils">rainforest.common.utils module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-rainforest.common.wgs84_ch1903">rainforest.common.wgs84_ch1903 module</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Rainforest QPE library</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Reference</a> &raquo;</li>
        
      <li>Common submodule</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/reference/common.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="common-submodule">
<span id="common"></span><h1>Common submodule<a class="headerlink" href="#common-submodule" title="Permalink to this headline">¶</a></h1>
<p>This module provides routines that are used throughout the library.</p>
<p><a class="reference internal" href="#module-rainforest.common.io_data" title="rainforest.common.io_data"><code class="xref py py-mod docutils literal notranslate"><span class="pre">rainforest.common.io_data</span></code></a> : read various MCH data formats</p>
<p><a class="reference internal" href="#module-rainforest.common.retrieve_data" title="rainforest.common.retrieve_data"><code class="xref py py-mod docutils literal notranslate"><span class="pre">rainforest.common.retrieve_data</span></code></a> : retrieve MCH files (COSMO, polar, Cartesian) from storage</p>
<p><a class="reference internal" href="#module-rainforest.common.radarprocessing" title="rainforest.common.radarprocessing"><code class="xref py py-mod docutils literal notranslate"><span class="pre">rainforest.common.radarprocessing</span></code></a> : radar processing routines</p>
<p><a class="reference internal" href="#module-rainforest.common.constants" title="rainforest.common.constants"><code class="xref py py-mod docutils literal notranslate"><span class="pre">rainforest.common.constants</span></code></a> : define constants used throughout the code</p>
<p><a class="reference internal" href="#module-rainforest.common.graphics" title="rainforest.common.graphics"><code class="xref py py-mod docutils literal notranslate"><span class="pre">rainforest.common.graphics</span></code></a> : creating plots for QPE realization and evaluation</p>
<p><a class="reference internal" href="#module-rainforest.common.lookup" title="rainforest.common.lookup"><code class="xref py py-mod docutils literal notranslate"><span class="pre">rainforest.common.lookup</span></code></a> : computing and reading lookup tables that are used for interpolation and geolocalization of data</p>
<p><a class="reference internal" href="#module-rainforest.common.lookup" title="rainforest.common.lookup"><code class="xref py py-mod docutils literal notranslate"><span class="pre">rainforest.common.lookup</span></code></a> : various small utilities used throughout the  code</p>
<div class="section" id="module-rainforest.common.io_data">
<span id="rainforest-common-io-data-module"></span><h2>rainforest.common.io_data module<a class="headerlink" href="#module-rainforest.common.io_data" title="Permalink to this headline">¶</a></h2>
<p>Functions to read MeteoSwiss products</p>
<p>Daniel Wolfensberger
MeteoSwiss/EPFL
<a class="reference external" href="mailto:daniel&#46;wolfensberger&#37;&#52;&#48;epfl&#46;ch">daniel<span>&#46;</span>wolfensberger<span>&#64;</span>epfl<span>&#46;</span>ch</a>
December 2019</p>
<dl class="function">
<dt id="rainforest.common.io_data.read_cart">
<code class="sig-prename descclassname">rainforest.common.io_data.</code><code class="sig-name descname">read_cart</code><span class="sig-paren">(</span><em class="sig-param">cart_file</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.io_data.read_cart" title="Permalink to this definition">¶</a></dt>
<dd><p>Generic function that reads a Cartesian radar file, either in gif or
binary format (ELDES or as generated by the qpe module of this library)
and converts its data to floating numbers</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>cart_file</strong> (<em>str</em>) – Full path of the file to read as a a string</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>The cartesian data in a numpy array</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="rainforest.common.io_data.read_gif">
<code class="sig-prename descclassname">rainforest.common.io_data.</code><code class="sig-name descname">read_gif</code><span class="sig-paren">(</span><em class="sig-param">gif_file</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.io_data.read_gif" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads a Cartesian radar file in gif format</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>gif_file</strong> (<em>str</em>) – Full path of the file to read as a a string</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>The cartesian data in a numpy array</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="rainforest.common.io_data.read_polar">
<code class="sig-prename descclassname">rainforest.common.io_data.</code><code class="sig-name descname">read_polar</code><span class="sig-paren">(</span><em class="sig-param">polar_files</em>, <em class="sig-param">physic_value=True</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.io_data.read_polar" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads a polar radar metranet file as a pyart radar instance, if multiple
files corresponding to multiple elevations (sweeps) are provided they are
merged into a single pyart instance</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>polar_files</strong> (<em>str</em><em> or </em><em>list of strings</em>) – <p>Can be either:
- Full path of the file to read as a a string
- string with wildcard pointing to the files to read,</p>
<blockquote>
<div><p>e.g. …../MLA192711055.*</p>
</div></blockquote>
<ul class="simple">
<li><p>a list of full filepaths</p></li>
</ul>
</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>sweepnumbers</strong> (<em>list</em>) – list of sweeps numbers corresponding to all files that were read</p></li>
<li><p><strong>merged</strong> (<em>a pyart Radar instance</em>)</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="rainforest.common.io_data.read_station_data">
<code class="sig-prename descclassname">rainforest.common.io_data.</code><code class="sig-name descname">read_station_data</code><span class="sig-paren">(</span><em class="sig-param">gauge_file</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.io_data.read_station_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads gauge data as given by the Climap software</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>gauge_file</strong> (<em>str</em>) – Full path of the file to read as a a string</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>The cartesian data in a numpy array</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="rainforest.common.io_data.read_status">
<code class="sig-prename descclassname">rainforest.common.io_data.</code><code class="sig-name descname">read_status</code><span class="sig-paren">(</span><em class="sig-param">status_file</em>, <em class="sig-param">add_wet_radome=False</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.io_data.read_status" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads a radar xml status file</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fname</strong> (<em>str</em>) – Full path of the status xml file to be read</p></li>
<li><p><strong>add_wet_Radome</strong> (<em>boolean</em><em> (</em><em>optional</em><em>)</em>) – For older files, there is not information about the wet radome.
If this is true, the script will estimate the wet radome precipitation
as a 3 x 3 mean of the RZC product at the given time (as is done for
more recent files)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>The status as a python dict</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="rainforest.common.io_data.read_vpr">
<code class="sig-prename descclassname">rainforest.common.io_data.</code><code class="sig-name descname">read_vpr</code><span class="sig-paren">(</span><em class="sig-param">xml_file</em>, <em class="sig-param">radar=None</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.io_data.read_vpr" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads a vpr xml file and returns an interpolator that can be used to obtain
the vpr correction at any altitude</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>vpr_file</strong> (<em>str</em>) – <p>Full path of the file to read
radar : char (optional)</p>
<blockquote>
<div><p>the radar is required to know the vpr reference height, it needs
to be either ‘A’,’D’,’L’,’P’ or ‘W’, if not specified, it will be
inferred from the vpr filename</p>
</div></blockquote>
</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>An interpolator that returns the vpr correction as a function of</em></p></li>
<li><p><em>the height, the correction is a multiplicative factor</em></p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="rainforest.common.io_data.read_xls">
<code class="sig-prename descclassname">rainforest.common.io_data.</code><code class="sig-name descname">read_xls</code><span class="sig-paren">(</span><em class="sig-param">xls_file</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.io_data.read_xls" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads an excel file such as those used for CPC vlaidation</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>fname</strong> (<em>str</em>) – Full path of the excel file to be read</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>The excel file as a Pandas dataframe</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="rainforest.common.io_data.save_gif">
<code class="sig-prename descclassname">rainforest.common.io_data.</code><code class="sig-name descname">save_gif</code><span class="sig-paren">(</span><em class="sig-param">gif_file</em>, <em class="sig-param">precip</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.io_data.save_gif" title="Permalink to this definition">¶</a></dt>
<dd><p>Saves a precipitation map in float to a gif file (AQC format)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>gif_file</strong> (<em>str</em>) – Full path of the file to write as a a string</p></li>
<li><p><strong>precip</strong> (<em>2D array</em>) – 2D array containing the precipitation intensities</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-rainforest.common.retrieve_data">
<span id="rainforest-common-retrieve-data-module"></span><h2>rainforest.common.retrieve_data module<a class="headerlink" href="#module-rainforest.common.retrieve_data" title="Permalink to this headline">¶</a></h2>
<p>Functions to retrieve MeteoSwiss products from the archives</p>
<p>Daniel Wolfensberger
MeteoSwiss/EPFL
<a class="reference external" href="mailto:daniel&#46;wolfensberger&#37;&#52;&#48;epfl&#46;ch">daniel<span>&#46;</span>wolfensberger<span>&#64;</span>epfl<span>&#46;</span>ch</a>
December 2019</p>
<dl class="function">
<dt id="rainforest.common.retrieve_data.get_COSMO_T">
<code class="sig-prename descclassname">rainforest.common.retrieve_data.</code><code class="sig-name descname">get_COSMO_T</code><span class="sig-paren">(</span><em class="sig-param">time</em>, <em class="sig-param">sweeps=None</em>, <em class="sig-param">radar=None</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.retrieve_data.get_COSMO_T" title="Permalink to this definition">¶</a></dt>
<dd><p>Retrieves COSMO temperature data from the CSCS repository, and
interpolates them to the radar gates, using precomputed lookup tables</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>time</strong> (<em>datetime.datetime instance</em>) – the time at which to get the COSMO data in datetime format</p></li>
<li><p><strong>sweeps</strong> (<em>list of integers</em>) – specify which sweeps (elevations) need to be retrieved in the form
of a list, if not specified, all 20 will be retrieved</p></li>
<li><p><strong>radar</strong> (<em>list of chars</em>) – list of radars for which to retrieve COSMO data, if not specified
all 5 radars will be used (‘A’,’L’,’D’,’W’,’P’)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>T_at_radar</strong> – A dict containing the temperature at the radar gates, in the following form:
dict[radar][‘T’][sweep_number]</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="rainforest.common.retrieve_data.get_COSMO_variables">
<code class="sig-prename descclassname">rainforest.common.retrieve_data.</code><code class="sig-name descname">get_COSMO_variables</code><span class="sig-paren">(</span><em class="sig-param">time</em>, <em class="sig-param">variables</em>, <em class="sig-param">sweeps=None</em>, <em class="sig-param">radar=None</em>, <em class="sig-param">tmp_folder='/tmp/'</em>, <em class="sig-param">cleanup=True</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.retrieve_data.get_COSMO_variables" title="Permalink to this definition">¶</a></dt>
<dd><p>Retrieves COSMO data from the CSCS repository, and
interpolates them to the radar gates, using precomputed lookup tables
This is a more generic but much slower function than the previous one,
as it reads all COSMO variables directly from the GRIB files</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>time</strong> (<em>datetime.datetime instance</em>) – the time at which to get the COSMO data in datetime format</p></li>
<li><p><strong>variables</strong> (<em>list of strings</em>) – List of COSMO variables to retrieve, ex. P, T, QV, QR, RH, etc…</p></li>
<li><p><strong>sweeps</strong> (<em>list of integers</em><em> (</em><em>optional</em><em>)</em>) – specify which sweeps (elevations) need to be retrieved in the form
of a list, if not specified, all 20 will be retrieved</p></li>
<li><p><strong>= list of chars</strong><strong> (</strong><strong>optional</strong><strong>)</strong> (<em>radar</em>) – list of radars for which to retrieve COSMO data, if not specified
all 5 radars will be used (‘A’,’L’,’D’,’W’,’P’)</p></li>
<li><p><strong>= str</strong><strong> (</strong><strong>optional</strong><strong>)</strong> (<em>tmp_folder</em>) – Directory where to store the extracted files</p></li>
<li><p><strong>= boolean</strong><strong> (</strong><strong>optional</strong><strong>)</strong> (<em>cleanup</em>) – If true all extracted files will be deleted before returning the output
(recommended)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>A dict containing the COSMO variables at the radar gates, in the following</em></p></li>
<li><p><strong>form</strong> (<em>dict[radar][variables][sweep_number]</em>)</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="rainforest.common.retrieve_data.retrieve_CPCCV">
<code class="sig-prename descclassname">rainforest.common.retrieve_data.</code><code class="sig-name descname">retrieve_CPCCV</code><span class="sig-paren">(</span><em class="sig-param">time</em>, <em class="sig-param">stations</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.retrieve_data.retrieve_CPCCV" title="Permalink to this definition">¶</a></dt>
<dd><p>Retrieves cross-validation CPC data for a set of stations from
the xls files prepared by Yanni</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>time</strong> (<em>datetime.datetime instance</em>) – starting time of the time range</p></li>
<li><p><strong>stations</strong> (<em>list of str</em>) – list of weather stations at which to retrieve the CPC.CV data</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>A numpy array corresponding at the CPC.CV estimations at every specified</em></p></li>
<li><p><em>station</em></p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="rainforest.common.retrieve_data.retrieve_prod">
<code class="sig-prename descclassname">rainforest.common.retrieve_data.</code><code class="sig-name descname">retrieve_prod</code><span class="sig-paren">(</span><em class="sig-param">folder_out</em>, <em class="sig-param">start_time</em>, <em class="sig-param">end_time</em>, <em class="sig-param">product_name</em>, <em class="sig-param">pattern=None</em>, <em class="sig-param">pattern_type='shell'</em>, <em class="sig-param">sweeps=None</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.retrieve_data.retrieve_prod" title="Permalink to this definition">¶</a></dt>
<dd><p>Retrieves radar data from the CSCS repository for a specified
time range, unzips them and places them in a specified folder</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>folder_out</strong> (<em>str</em>) – directory where to store the unzipped files</p></li>
<li><p><strong>start_time</strong> (<em>datetime.datetime instance</em>) – starting time of the time range</p></li>
<li><p><strong>end_time</strong> (<em>datetime.datetime instance</em>) – end time of the time range</p></li>
<li><p><strong>product_name</strong> (<em>str</em>) – name of the product, as stored on CSCS, e.g. RZC, CPCH, MZC, BZC…</p></li>
<li><p><strong>pattern</strong> (<em>str</em>) – pattern constraint on file names, can be used for products which contain
multiple filetypes, f.ex CPCH folders contain both rda and gif files,
if only gifs are wanted : file_type = ‘<a href="#id1"><span class="problematic" id="id2">*</span></a>.gif’</p></li>
<li><p><strong>pattern_type</strong> (<em>either 'shell'</em><em> or </em><em>'regex'</em><em> (</em><em>optional</em><em>)</em>) – use ‘shell’ for standard shell patterns, which use * as wildcard
use ‘regex’ for more advanced regex patterns</p></li>
<li><p><strong>sweeps</strong> (<em>list of int</em><em> (</em><em>optional</em><em>)</em>) – For polar products, specifies which sweeps (elevations) must be
retrieved, if not specified all available sweeps will be retrieved</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>A list containing all the filepaths of the retrieved files</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-rainforest.common.radarprocessing">
<span id="rainforest-common-radarprocessing-module"></span><h2>rainforest.common.radarprocessing module<a class="headerlink" href="#module-rainforest.common.radarprocessing" title="Permalink to this headline">¶</a></h2>
<p>Created on Mon Dec 16 17:38:52 2019</p>
<p>&#64;author: wolfensb</p>
<dl class="class">
<dt id="rainforest.common.radarprocessing.Radar">
<em class="property">class </em><code class="sig-prename descclassname">rainforest.common.radarprocessing.</code><code class="sig-name descname">Radar</code><span class="sig-paren">(</span><em class="sig-param">radname</em>, <em class="sig-param">polfiles</em>, <em class="sig-param">statusfile=None</em>, <em class="sig-param">vprfile=None</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.radarprocessing.Radar" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A class that contains polar radar data and performs some pre-processing
before adding that data to the database or computing the QPE product
The different elevations are stored in a dictionary rather as in a
single pyart radar instance as this was found to be faster in practice</p>
<p>Creates an Radar class instance</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>radname</strong> (<em>char</em>) – Name of the radar, either ‘A’,’D’,’L’,’P’ or ‘W’</p></li>
<li><p><strong>polfiles</strong> (<em>list of str</em>) – List of full filepaths of the radar files for a given timestemp,
one file for every elevation, typically obtained with
the retrieve_prod function in the common submodule</p></li>
<li><p><strong>statusfile</strong> (<em>str</em><em> (</em><em>optional</em><em>)</em>) – Full path of the status file that corresponds to this particular
radar and timestep, used to compute noise estimates</p></li>
<li><p><strong>vprfile</strong> (<em>str</em><em>(</em><em>optional</em><em>)</em>) – Full path of the vpr xml file that corresponds to this particular
radar and timestep, used to compute VPR correction</p></li>
</ul>
</dd>
</dl>
<dl class="method">
<dt id="rainforest.common.radarprocessing.Radar.add_cosmo_data">
<code class="sig-name descname">add_cosmo_data</code><span class="sig-paren">(</span><em class="sig-param">cosmo_data</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.radarprocessing.Radar.add_cosmo_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds COSMO data to the radar instance</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>cosmo_data</strong> (<em>dict</em>) – <p>dict of COSMO data at polar coordinates obtained from the
get_COSMO_variables function in the common submodule
this dict must have the following format</p>
<blockquote>
<div><p>dic[variable][sweep]</p>
</div></blockquote>
</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="rainforest.common.radarprocessing.Radar.compute_hydro">
<code class="sig-name descname">compute_hydro</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.radarprocessing.Radar.compute_hydro" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes the hydrometeor classification using Nikola Besic’
algorithm, all necessary fields
ZH, ZDR, RHOHV, KDP, T (COSMO) must be available</p>
</dd></dl>

<dl class="method">
<dt id="rainforest.common.radarprocessing.Radar.compute_kdp">
<code class="sig-name descname">compute_kdp</code><span class="sig-paren">(</span><em class="sig-param">dscfg</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.radarprocessing.Radar.compute_kdp" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes KDP using the simple moving least-square algorithm</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>dscfg</strong> (<em>dict</em>) – dictionary containing the following fields
RMIN:
RMAX:
RWIND:
ZMIN:
ZMAX:</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="rainforest.common.radarprocessing.Radar.compute_noise">
<code class="sig-name descname">compute_noise</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.radarprocessing.Radar.compute_noise" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes a noise estimate from a status file</p>
</dd></dl>

<dl class="method">
<dt id="rainforest.common.radarprocessing.Radar.correct_attenuation">
<code class="sig-name descname">correct_attenuation</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.radarprocessing.Radar.correct_attenuation" title="Permalink to this definition">¶</a></dt>
<dd><p>Corrects for attenuation using the ZPHI algorithm (Testud et al.)
using the COSMO temperature to identify liquid precipitation</p>
</dd></dl>

<dl class="method">
<dt id="rainforest.common.radarprocessing.Radar.get_field">
<code class="sig-name descname">get_field</code><span class="sig-paren">(</span><em class="sig-param">sweep</em>, <em class="sig-param">field_name</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.radarprocessing.Radar.get_field" title="Permalink to this definition">¶</a></dt>
<dd><p>Gets a radar variable at given elevation (sweep)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sweep</strong> (<em>int</em>) – Sweep number from 1 to 20</p></li>
<li><p><strong>field_name</strong> (<em>str</em>) – name of the variable, e.g. ZH, ZDR, RHOHV, SW, …</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="rainforest.common.radarprocessing.Radar.snr_mask">
<code class="sig-name descname">snr_mask</code><span class="sig-paren">(</span><em class="sig-param">snr_threshold</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.radarprocessing.Radar.snr_mask" title="Permalink to this definition">¶</a></dt>
<dd><p>Masks the radar data at low SNR</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>snr_threshold</strong> (<em>float</em>) – Minimal SNR to consider in dB</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="rainforest.common.radarprocessing.Radar.visib_mask">
<code class="sig-name descname">visib_mask</code><span class="sig-paren">(</span><em class="sig-param">min_visib</em>, <em class="sig-param">max_visib_corr</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.radarprocessing.Radar.visib_mask" title="Permalink to this definition">¶</a></dt>
<dd><p>Masks the radar data at low visibility and corrects the reflectivity
for visibility</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>min_visib</strong> (<em>int</em>) – Minimal visibility below which the data is masked</p></li>
<li><p><strong>max_visib_corr</strong> (<em>float</em>) – Maximum visibility correction factor, the visibility correction
is 100/VISIB (with VISIB in %) and can be thresholded with this
parameter. This is usually set to 2 at MeteoSwiss</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="rainforest.common.radarprocessing.hydroClass_single">
<code class="sig-prename descclassname">rainforest.common.radarprocessing.</code><code class="sig-name descname">hydroClass_single</code><span class="sig-paren">(</span><em class="sig-param">radars</em>, <em class="sig-param">zh</em>, <em class="sig-param">zdr</em>, <em class="sig-param">kdp</em>, <em class="sig-param">rhohv</em>, <em class="sig-param">temp</em>, <em class="sig-param">weights=array([1.</em>, <em class="sig-param">1.</em>, <em class="sig-param">1.</em>, <em class="sig-param">0.75</em>, <em class="sig-param">0.5 ])</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.radarprocessing.hydroClass_single" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes the hydrometeor classes for columnar data, note that all input
arrays except weights must have the same length</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>radars</strong> (<em>ndarray of char</em>) – Array of radar IDs, (‘A’,’D’,’L’,’P’,’W’)</p></li>
<li><p><strong>zh</strong> (<em>ndarray</em>) – Array of radar reflectivity in dBZ</p></li>
<li><p><strong>zdr</strong> (<em>ndarray</em>) – Array of diff. reflectivity in dB</p></li>
<li><p><strong>kdp</strong> (<em>ndarray</em>) – Array of specific phase shift on propagation in deg / km</p></li>
<li><p><strong>rhohv</strong> (<em>ndarray</em>) – Array of copolar correlation coefficient</p></li>
<li><p><strong>temp</strong> (<em>ndarray</em>) – Array of radar temperature in Celcius</p></li>
<li><p><strong>weights</strong> (<em>ndarray</em><em> (</em><em>optional</em><em>)</em>) – The weight of every input feature, zh, zdr, kdp, rhohv, temp in the
hydrometeor classification</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>The hydrometeor classes as ndarray with values from 0 to 8, corresponding to</em></p></li>
<li><p><em>the classes</em> – 0 : no data
1 : aggregates (AG)
2 : light rain (LR)
3 : ice crystals (CR)
4 : rimed particles (RP)
5 : rain (RN)
6 : vertically aligned ice (VI)
7 : wet snow (WS)
8 : melting hail (MH)
9: dry hail / high density graupel (IH/HDG)</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-rainforest.common.constants">
<span id="rainforest-common-constants-module"></span><h2>rainforest.common.constants module<a class="headerlink" href="#module-rainforest.common.constants" title="Permalink to this headline">¶</a></h2>
<p>Set of constants regarding MeteoSwiss radars and QPE</p>
<dl class="function">
<dt id="rainforest.common.constants.MODE">
<code class="sig-prename descclassname">rainforest.common.constants.</code><code class="sig-name descname">MODE</code><span class="sig-paren">(</span><em class="sig-param">x</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.constants.MODE" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="module-rainforest.common.graphics">
<span id="rainforest-common-graphics-module"></span><h2>rainforest.common.graphics module<a class="headerlink" href="#module-rainforest.common.graphics" title="Permalink to this headline">¶</a></h2>
<p>Set of functions to display QPE precipitation data and verification scores</p>
<dl class="class">
<dt id="rainforest.common.graphics.MidpointNormalize">
<em class="property">class </em><code class="sig-prename descclassname">rainforest.common.graphics.</code><code class="sig-name descname">MidpointNormalize</code><span class="sig-paren">(</span><em class="sig-param">vmin=None</em>, <em class="sig-param">vmax=None</em>, <em class="sig-param">transition=None</em>, <em class="sig-param">clip=False</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.graphics.MidpointNormalize" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">matplotlib.colors.Normalize</span></code></p>
<p>Normalizing that is linear up to a certain transition value, logarithmic
afterwards</p>
<p>If <em>vmin</em> or <em>vmax</em> is not given, they are initialized from the
minimum and maximum value respectively of the first input
processed.  That is, <em>__call__(A)</em> calls <em>autoscale_None(A)</em>.
If <em>clip</em> is <em>True</em> and the given value falls outside the range,
the returned value will be 0 or 1, whichever is closer.
Returns 0 if:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vmin</span><span class="o">==</span><span class="n">vmax</span>
</pre></div>
</div>
<p>Works with scalars or arrays, including masked arrays.  If
<em>clip</em> is <em>True</em>, masked values are set to 1; otherwise they
remain masked.  Clipping silently defeats the purpose of setting
the over, under, and masked colors in the colormap, so it is
likely to lead to surprises; therefore the default is
<em>clip</em> = <em>False</em>.</p>
</dd></dl>

<dl class="class">
<dt id="rainforest.common.graphics.QPE_cmap">
<em class="property">class </em><code class="sig-prename descclassname">rainforest.common.graphics.</code><code class="sig-name descname">QPE_cmap</code><a class="headerlink" href="#rainforest.common.graphics.QPE_cmap" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">matplotlib.colors.LinearSegmentedColormap</span></code></p>
<p>Colormap that uses purple tones for small values, and then a transition
from blue to red for values above the transition</p>
<p>Create color map from linear mapping segments</p>
<p>segmentdata argument is a dictionary with a red, green and blue
entries. Each entry should be a list of <em>x</em>, <em>y0</em>, <em>y1</em> tuples,
forming rows in a table. Entries for alpha are optional.</p>
<p>Example: suppose you want red to increase from 0 to 1 over
the bottom half, green to do the same over the middle half,
and blue over the top half.  Then you would use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cdict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;red&#39;</span><span class="p">:</span>   <span class="p">[(</span><span class="mf">0.0</span><span class="p">,</span>  <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                   <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span>  <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
                   <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span>  <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)],</span>

         <span class="s1">&#39;green&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="mf">0.0</span><span class="p">,</span>  <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                   <span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                   <span class="p">(</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
                   <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span>  <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)],</span>

         <span class="s1">&#39;blue&#39;</span><span class="p">:</span>  <span class="p">[(</span><span class="mf">0.0</span><span class="p">,</span>  <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                   <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span>  <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                   <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span>  <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)]}</span>
</pre></div>
</div>
<p>Each row in the table for a given color is a sequence of
<em>x</em>, <em>y0</em>, <em>y1</em> tuples.  In each sequence, <em>x</em> must increase
monotonically from 0 to 1.  For any input value <em>z</em> falling
between <em>x[i]</em> and <em>x[i+1]</em>, the output value of a given color
will be linearly interpolated between <em>y1[i]</em> and <em>y0[i+1]</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">row</span> <span class="n">i</span><span class="p">:</span>   <span class="n">x</span>  <span class="n">y0</span>  <span class="n">y1</span>
               <span class="o">/</span>
              <span class="o">/</span>
<span class="n">row</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span> <span class="n">x</span>  <span class="n">y0</span>  <span class="n">y1</span>
</pre></div>
</div>
<p>Hence y0 in the first row and y1 in the last row are never used.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><code class="xref py py-class docutils literal notranslate"><span class="pre">LinearSegmentedColormap.from_list</span></code></dt><dd><p>Static method; factory function for generating a smoothly-varying LinearSegmentedColormap.</p>
</dd>
<dt><code class="xref py py-class docutils literal notranslate"><span class="pre">makeMappingArray</span></code></dt><dd><p>For information about making a mapping array.</p>
</dd>
</dl>
</div>
</dd></dl>

<dl class="function">
<dt id="rainforest.common.graphics.plot_crossval_stats">
<code class="sig-prename descclassname">rainforest.common.graphics.</code><code class="sig-name descname">plot_crossval_stats</code><span class="sig-paren">(</span><em class="sig-param">stats</em>, <em class="sig-param">output_folder</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.graphics.plot_crossval_stats" title="Permalink to this definition">¶</a></dt>
<dd><p>Plots the results of a crossvalidation intercomparion as performed in
the rf.py module</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>stats</strong> (<em>dict</em>) – dictionary containing the result statistics as obtained in the
rf.py:model_intercomparison function</p></li>
<li><p><strong>output_folder</strong> (<em>str</em>) – where to store the plots</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="rainforest.common.graphics.qpe_plot">
<code class="sig-prename descclassname">rainforest.common.graphics.</code><code class="sig-name descname">qpe_plot</code><span class="sig-paren">(</span><em class="sig-param">data</em>, <em class="sig-param">subplots=None</em>, <em class="sig-param">figsize=None</em>, <em class="sig-param">vmin=0.04</em>, <em class="sig-param">vmax=120</em>, <em class="sig-param">transition=10</em>, <em class="sig-param">ch_border=True</em>, <em class="sig-param">xlim=None</em>, <em class="sig-param">ylim=None</em>, <em class="sig-param">cbar_orientation='horizontal'</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.graphics.qpe_plot" title="Permalink to this definition">¶</a></dt>
<dd><p>Plots one or multiple QPE realizations using a special colormap, that
shows a clear transition between low and high precipitation intensities,
for low precipitation it is linear whereas for high precipitation it is
logarithmic</p>
<p>If multiple QPE realizations are given, they will be displayed as subplots</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<em>list of numpy arrays</em><em> or </em><em>numpy array</em>) – the set of QPE realizations to display</p></li>
<li><p><strong>subplots</strong> (<em>2-element tuple</em><em> (</em><em>optional</em><em>)</em>) – Tuple indicating the number of subplots in each direction,
the product of its elements must be equal to the number of QPE realizations
If not provided, the default will be (1,n) where n is the number of
realizations</p></li>
<li><p><strong>figsize</strong> (<em>2-element tuple</em><em> (</em><em>optional</em><em>)</em>) – Tuple indicating the size of the figure in inches in both directions
(w,h)</p></li>
<li><p><strong>vmin</strong> (<em>float</em><em> (</em><em>optional</em><em>)</em>) – Minimum value of precipitation to display, values below will be blank</p></li>
<li><p><strong>vmax</strong> (<em>float</em><em> (</em><em>optional</em><em>)</em>) – Maximum value of precipitation to display, values below above will
be shown with the color corresponding to vmax</p></li>
<li><p><strong>transition</strong> (<em>float</em><em> (</em><em>optional</em><em>)</em>) – The transition value from which to change colormap and switch
from linear to logarithmic scale</p></li>
<li><p><strong>ch_border</strong> (<em>bool</em><em> (</em><em>optiona</em><em>)</em>) – Whether to overlay the shapefile of the Swiss borders</p></li>
<li><p><strong>xlim</strong> (<em>2 element tuple</em><em> (</em><em>optional</em><em>)</em>) – limits of the plots in the west-east direction (in Swiss coordinates)</p></li>
<li><p><strong>ylim</strong> (<em>2 element tuple</em><em> (</em><em>optional</em><em>)</em>) – limits of the plots in the south-north direction (in Swiss coordinates)</p></li>
<li><p><strong>cbar_orientation</strong> (<em>str</em><em> (</em><em>optional</em><em>)</em>) – colorbar orientation, either ‘horizontal’ or ‘vertical’</p></li>
<li><p><strong>**kwargs</strong> – All additional arguments that can be passed to imshow</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>Nothing</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="rainforest.common.graphics.qpe_scatterplot">
<code class="sig-prename descclassname">rainforest.common.graphics.</code><code class="sig-name descname">qpe_scatterplot</code><span class="sig-paren">(</span><em class="sig-param">qpe_est</em>, <em class="sig-param">ref</em>, <em class="sig-param">title_prefix=''</em>, <em class="sig-param">figsize=(10</em>, <em class="sig-param">7.5)</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.graphics.qpe_scatterplot" title="Permalink to this definition">¶</a></dt>
<dd><p>Plots the results of multiple QPE models as a function of the
reference gauge measurement</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>qpe_est</strong> (<em>dict of arrays</em>) – Every value in the dictionary is a set of QPE estimates, every key
is a model</p></li>
<li><p><strong>ref</strong> (<em>np.ndarray</em>) – contains the reference observations (gauge), must have the same shape
as any element in qpe_est</p></li>
</ul>
</dd>
</dl>
<dl class="simple">
<dt>title_prefix: str (optional)</dt><dd><p>a prefix for the suptitle (global titl</p>
</dd>
<dt>figsize: 2-element tuple (optional)</dt><dd><p>Tuple indicating the size of the figure in inches in both directions
(w,h)</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>Nothing</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="rainforest.common.graphics.score_plot">
<code class="sig-prename descclassname">rainforest.common.graphics.</code><code class="sig-name descname">score_plot</code><span class="sig-paren">(</span><em class="sig-param">scores</em>, <em class="sig-param">title_prefix=''</em>, <em class="sig-param">figsize=(10</em>, <em class="sig-param">5)</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.graphics.score_plot" title="Permalink to this definition">¶</a></dt>
<dd><p>Plots a series of QPE verification scores in the form of stacked
barplots, for different ranges of precipitation</p>
<p>IMPORTANT: the scores dictionary must have the following structure</p>
<p>scores[model][precip_range][score]</p>
<p>for example</p>
<p>scores[‘RF_dualpol’][‘0.0-2.0’][‘ME’] = -0.27</p>
<p>you can get such a dictionary with the perfscores function in common.utils
i.e. scores[‘RZC’] = perfscores(…)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>scores</strong> (<em>dict of dict of dict of scores</em>) – the set of scores to display</p></li>
<li><p><strong>title_prefix</strong> (<em>str</em><em> (</em><em>optional</em><em>)</em>) – a prefix for the suptitle (global title)</p></li>
<li><p><strong>figsize</strong> (<em>2-element tuple</em><em> (</em><em>optional</em><em>)</em>) – Tuple indicating the size of the figure in inches in both directions
(w,h)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>Nothing</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-rainforest.common.lookup">
<span id="rainforest-common-lookup-module"></span><h2>rainforest.common.lookup module<a class="headerlink" href="#module-rainforest.common.lookup" title="Permalink to this headline">¶</a></h2>
<p>Functions to read and compute lookup tables</p>
<p>The available lookup tables are</p>
<p><strong>qpebias_station</strong> : dict with the bias correction of RZC at every station</p>
<p><strong>cosmo1_to_rad</strong> : dict which maps COSMO grid to polar radar grid
it has  keys [sweep][coord_type], coord_type is ‘idx_0’ :
first index of COSMO grids, ‘idx_1’: second, ‘idx_3’: third,
mask’ is 1 for points that fall outside of COSMO domain. This lookup table
is valid only for COSMO data stored in /store/s83/owm/COSMO-1/</p>
<p><strong>cosmo2_to_rad</strong> : same thing but for COSMO 2 data</p>
<p><strong>cosmo1T_to_rad</strong> : same thing but for netCDF files of COSMO1 temperature
extracted for MDR and stored in /store/s83/owm/COSMO-1/ORDERS/MDR/</p>
<p><strong>cosmo1T_to_rad</strong> : same thing but for netCDF files of COSMO2 temperature
extracted for MDR and stored in /store/msrad/cosmo/cosmo2/data/</p>
<p><strong>station_to_rad</strong> : maps the SMN stations to radar coordinates, it is an
extraction of the more generic but less convenient <strong>qpegrid_to_rad</strong> table
It is list of 3 elements, first element is a dict with keys [station][sweep][ncode]
and gives the polar gates (azimuth_idx, range_idx) that fall within a Cartesian pixel
at a given radar elevation and for a given station neighbour (00 = station location,
-1-1 = one to the south-west, 22 = two km to north and 2 km to east)
second element is a dict giving distance from every station to the radar
third element is a dict of keys [station][sweep] giving the height above
ground of the radar observations above that station at a given elevation (sweep)
MISSING KEYS IMPLY NO RADAR VISIBILITY</p>
<p><strong>cartcoords_rad</strong> : gives the Cartesian (Swiss LV03) coordinates of all
polar gates. It is a dict that gives for every sweep a 3D array
of shape ncoords x nazimuth x nrange, ncoords is 3, first slice is
Swiss Y coordinate (west to east), second is Swiss X-coordinate (south to north)
and last is Swiss Z coordinate (altitude)</p>
<p><strong>qpegrid_to_rad</strong> : maps the radar polar data to any gridpoint of the Swiss
QPE grid. It is simply a 2D array with 5 columns
| sweep | azimuth_idx | range_idx | Swiss Y coord | Swiss X coord|</p>
<p><strong>station_to_qpegrid</strong> : maps every station to the corresponding QPE gridpoint
it is a dict of keys [station][ncode] and gives the index of every
neighbour of every station in the QPE 2D grid 640 x 710 pixels</p>
<p><strong>visibility_rad</strong> : gives the (static) visibility of every polar gate
for a given sweep number in the form of a 2D field of size nazimuth x nrange</p>
<dl class="function">
<dt id="rainforest.common.lookup.calc_lookup">
<code class="sig-prename descclassname">rainforest.common.lookup.</code><code class="sig-name descname">calc_lookup</code><span class="sig-paren">(</span><em class="sig-param">lookup_type</em>, <em class="sig-param">radar=None</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.lookup.calc_lookup" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates a lookup table and stores it in the /data/lookup_data folder</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>lookup_type</strong> (<em>str</em>) – <p>the lookup table type, must be one of</p>
<ul>
<li><p>qpebias_station</p></li>
<li><p>cosmo1_to_rad</p></li>
<li><p>cosmo2_to_rad</p></li>
<li><p>cosmo1T_to_rad</p></li>
<li><p>cosmo2T_to_rad</p></li>
<li><p>station_to_rad</p></li>
<li><p>cartcoords_rad</p></li>
<li><p>qpegrid_to_rad</p></li>
<li><p>station_to_qpegrid</p></li>
<li><p>visibility_rad</p></li>
</ul>
</p></li>
<li><p><strong>radar</strong> (<em>char</em><em> or </em><em>list of chars</em><em> (</em><em>optional</em><em>)</em>) – the radar for which to retrieve the lookup table, needed only
if the lookup_type contains the term ‘rad’, must be either ‘A’, ‘D’, ‘L’,
‘W’ or ‘P’</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="rainforest.common.lookup.get_lookup">
<code class="sig-prename descclassname">rainforest.common.lookup.</code><code class="sig-name descname">get_lookup</code><span class="sig-paren">(</span><em class="sig-param">lookup_type</em>, <em class="sig-param">radar=None</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.lookup.get_lookup" title="Permalink to this definition">¶</a></dt>
<dd><p>Read a lookup table from the /data/lookup_data folder</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>lookup_type</strong> (<em>str</em>) – <p>the lookup table type, must be one of</p>
<ul>
<li><p>qpebias_station</p></li>
<li><p>cosmo1_to_rad</p></li>
<li><p>cosmo2_to_rad</p></li>
<li><p>cosmo1T_to_rad</p></li>
<li><p>cosmo2T_to_rad</p></li>
<li><p>station_to_rad</p></li>
<li><p>cartcoords_rad</p></li>
<li><p>qpegrid_to_rad</p></li>
<li><p>station_to_qpegrid</p></li>
<li><p>visibility_rad</p></li>
</ul>
</p></li>
<li><p><strong>radar</strong> (<em>char</em><em> or </em><em>list of chars</em><em> (</em><em>optional</em><em>)</em>) – the radar for which to retrieve the lookup table, needed only
if the lookup_type contains the term ‘rad’, must be either ‘A’, ‘D’, ‘L’,
‘W’ or ‘P’</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>lut</strong> – The lookup table in the form of a python dict</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-rainforest.common.utils">
<span id="rainforest-common-utils-module"></span><h2>rainforest.common.utils module<a class="headerlink" href="#module-rainforest.common.utils" title="Permalink to this headline">¶</a></h2>
<p>Set of functions that can be useful</p>
<p>Daniel Wolfensberger
MeteoSwiss/EPFL
<a class="reference external" href="mailto:daniel&#46;wolfensberger&#37;&#52;&#48;epfl&#46;ch">daniel<span>&#46;</span>wolfensberger<span>&#64;</span>epfl<span>&#46;</span>ch</a>
December 2019</p>
<dl class="function">
<dt id="rainforest.common.utils.LV03toWGS84">
<code class="sig-prename descclassname">rainforest.common.utils.</code><code class="sig-name descname">LV03toWGS84</code><span class="sig-paren">(</span><em class="sig-param">east</em>, <em class="sig-param">north</em>, <em class="sig-param">heights</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.utils.LV03toWGS84" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts a set of WGS84, lat/lon/heights to Swiss CH1903 coordinates</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>east</strong> (<em>ndarray</em>) – Easterly Swiss coordinates (CHY)</p></li>
<li><p><strong>north</strong> (<em>ndarray</em>) – northerly Swiss coordinates (CHX)</p></li>
<li><p><strong>heights</strong> (<em>ndarray</em>) – heights a.s.l in WGS84 coordinates</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>lat, lon and height coordinates in WGS84</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="rainforest.common.utils.aggregate_multi">
<code class="sig-prename descclassname">rainforest.common.utils.</code><code class="sig-name descname">aggregate_multi</code><span class="sig-paren">(</span><em class="sig-param">array_3d</em>, <em class="sig-param">agg_operators</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.utils.aggregate_multi" title="Permalink to this definition">¶</a></dt>
<dd><p>Aggregates a 3D numpy array alongs its first axis, using different
aggregation operators</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>array_3d</strong> (<em>ndarray</em>) – 3D numpy array, of shape (N x M x L)</p></li>
<li><p><strong>agg_operators</strong> (<em>ndarray of integers</em>) – array of aggregation operators as defined in the constants.py file,
must have the same length as the first dimension of array_3D (N)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>An aggregated array of size M x L</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="rainforest.common.utils.chunks">
<code class="sig-prename descclassname">rainforest.common.utils.</code><code class="sig-name descname">chunks</code><span class="sig-paren">(</span><em class="sig-param">l</em>, <em class="sig-param">n</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.utils.chunks" title="Permalink to this definition">¶</a></dt>
<dd><p>Divides a list l into n sublists of similar sizes</p>
</dd></dl>

<dl class="function">
<dt id="rainforest.common.utils.dict_flatten">
<code class="sig-prename descclassname">rainforest.common.utils.</code><code class="sig-name descname">dict_flatten</code><span class="sig-paren">(</span><em class="sig-param">mydict</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.utils.dict_flatten" title="Permalink to this definition">¶</a></dt>
<dd><p>Flattens a nested dictionary</p>
</dd></dl>

<dl class="function">
<dt id="rainforest.common.utils.envyaml">
<code class="sig-prename descclassname">rainforest.common.utils.</code><code class="sig-name descname">envyaml</code><span class="sig-paren">(</span><em class="sig-param">filename</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.utils.envyaml" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads a yaml configuration file while parsing environment variables.
Environment variables must be written as ${NAME_OF_VAR} in the yaml file</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>filename</strong> (<em>str</em>) – path of the input yaml file</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the yaml content in the form of a python dict</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="rainforest.common.utils.get_qpe_files">
<code class="sig-prename descclassname">rainforest.common.utils.</code><code class="sig-name descname">get_qpe_files</code><span class="sig-paren">(</span><em class="sig-param">input_folder</em>, <em class="sig-param">t0=None</em>, <em class="sig-param">t1=None</em>, <em class="sig-param">time_agg=None</em>, <em class="sig-param">list_models=None</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.utils.get_qpe_files" title="Permalink to this definition">¶</a></dt>
<dd><p>Gets the list of all qpe files in a folder (as saved by qpe_compute)
and separates them by qpe type and timestep</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_folder</strong> (<em>str</em>) – main directory where the qpe files are saved, it contains one subfolder
for every qpe model (type) that was used</p></li>
<li><p><strong>t0</strong> (<em>datetime</em><em> (</em><em>optional</em><em>)</em>) – Starting time of the period to retrieve, will be used to filter files,
if not provided starting time will be time of first file</p></li>
<li><p><strong>t1</strong> (<em>datetime</em><em> (</em><em>optional</em><em>)</em>) – End time of the period to retrieve, will be used to filter files,
if not provided end time will be time of last file</p></li>
<li><p><strong>time_agg</strong> (<em>minutes</em><em> (</em><em>optional</em><em>)</em>) – Will aggregate all files to a reference time in minutes (e.g. use 10 to
put together all files that correspond to a single gauge measurement)</p></li>
<li><p><strong>list_models</strong> (<em>(</em><em>optional</em><em>)</em>) – List of qpe types to retrieve , if not provided all folders in input_folder
will be used</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>A dictionary where every key is a QPE model and every value is a list</em></p></li>
<li><p><em>with all files in chronological order</em></p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="rainforest.common.utils.hex_to_rgb">
<code class="sig-prename descclassname">rainforest.common.utils.</code><code class="sig-name descname">hex_to_rgb</code><span class="sig-paren">(</span><em class="sig-param">value</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.utils.hex_to_rgb" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="rainforest.common.utils.idx_cart">
<code class="sig-prename descclassname">rainforest.common.utils.</code><code class="sig-name descname">idx_cart</code><span class="sig-paren">(</span><em class="sig-param">x</em>, <em class="sig-param">y</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.utils.idx_cart" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the Cartesian index of a set of coordinates x and y</p>
</dd></dl>

<dl class="function">
<dt id="rainforest.common.utils.nanadd_at">
<code class="sig-prename descclassname">rainforest.common.utils.</code><code class="sig-name descname">nanadd_at</code><span class="sig-paren">(</span><em class="sig-param">a</em>, <em class="sig-param">indices</em>, <em class="sig-param">b</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.utils.nanadd_at" title="Permalink to this definition">¶</a></dt>
<dd><p>Replaces nans by zero in call to np.add.at</p>
</dd></dl>

<dl class="function">
<dt id="rainforest.common.utils.nearest_time">
<code class="sig-prename descclassname">rainforest.common.utils.</code><code class="sig-name descname">nearest_time</code><span class="sig-paren">(</span><em class="sig-param">dt</em>, <em class="sig-param">reference</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.utils.nearest_time" title="Permalink to this definition">¶</a></dt>
<dd><p>Gets the nearest earlier reference timestep to a given datetime, for ex.
if dt = 1 Jan 2020 10:12, and reference is 10 it will return</p>
<blockquote>
<div><p>1 Jan 2020 10:10, or if dt = 1 Jan 2020 10:59 and reference is 60
it will return 1 Jan 2020 10:00</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dt</strong> (<em>datetime</em>) – The datetime to check</p></li>
<li><p><strong>reference</strong> (<em>int</em>) – The reference timestep in minutes</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>The closest earlier timestep in datetime format</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="rainforest.common.utils.nested_dict_gen">
<code class="sig-prename descclassname">rainforest.common.utils.</code><code class="sig-name descname">nested_dict_gen</code><span class="sig-paren">(</span><em class="sig-param">d</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.utils.nested_dict_gen" title="Permalink to this definition">¶</a></dt>
<dd><p>The generator for the previous function</p>
</dd></dl>

<dl class="function">
<dt id="rainforest.common.utils.nested_dict_values">
<code class="sig-prename descclassname">rainforest.common.utils.</code><code class="sig-name descname">nested_dict_values</code><span class="sig-paren">(</span><em class="sig-param">d</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.utils.nested_dict_values" title="Permalink to this definition">¶</a></dt>
<dd><p>Extracts all values from a nested dictionary</p>
</dd></dl>

<dl class="function">
<dt id="rainforest.common.utils.perfscores">
<code class="sig-prename descclassname">rainforest.common.utils.</code><code class="sig-name descname">perfscores</code><span class="sig-paren">(</span><em class="sig-param">est_data</em>, <em class="sig-param">ref_data</em>, <em class="sig-param">bounds=None</em>, <em class="sig-param">array=False</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.utils.perfscores" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes a set of precipitation performance scores, on different data ranges.
The scores are</p>
<blockquote>
<div><ul class="simple">
<li><p>scatter: 0.5 * (Qw84(x) - Qw16(x)), where Qw is a quantile weighted
by ref_data / sum(ref_data) and x is est_data / ref_data in dB scale</p></li>
<li><p>RMSE: root mean  square error (linear error)</p></li>
<li><p>bias:  (ME/mean(ref_data) + 1) in dB</p></li>
<li><p>ED: the energy distance which is a measure of the distance between
two distributions (<a class="reference external" href="https://en.wikipedia.org/wiki/Energy_distance">https://en.wikipedia.org/wiki/Energy_distance</a>)</p></li>
</ul>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>est_data</strong> (<em>ndarray</em>) – array of estimates (ex. precip from QPE)</p></li>
<li><p><strong>ref_data</strong> (<em>ndarray</em>) – array of reference (ex. precip from gauge)</p></li>
<li><p><strong>bounds</strong> (<em>list</em><em> (</em><em>optional</em><em>)</em>) – list of bounds on ref_data for which to compute the error metrics,
by default all data will be used (unbounded), note that even if you
prescribe bounds the scores for the overall data will always be
added in the output</p></li>
<li><p><strong>array</strong> (<em>boolean</em><em> (</em><em>optional</em><em>)</em>) – Whether or not to convert the output dict to a numpy array</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>all_metrics</strong> – a dictionary containing all the scores, organized in the following way
all_metrics[bound][score]</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict or ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="rainforest.common.utils.quantile">
<code class="sig-prename descclassname">rainforest.common.utils.</code><code class="sig-name descname">quantile</code><span class="sig-paren">(</span><em class="sig-param">data</em>, <em class="sig-param">weights</em>, <em class="sig-param">quantile</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.utils.quantile" title="Permalink to this definition">¶</a></dt>
<dd><p>Weighted quantile of an array with respect to the last axis.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<em>ndarray</em>) – Input array.</p></li>
<li><p><strong>weights</strong> (<em>ndarray</em>) – Array with the weights. It must have the same size of the last
axis of <cite>data</cite>.</p></li>
<li><p><strong>quantile</strong> (<em>float</em>) – Quantile to compute. It must have a value between 0 and 1.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>quantile</strong> – The output value.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="rainforest.common.utils.quantile_1D">
<code class="sig-prename descclassname">rainforest.common.utils.</code><code class="sig-name descname">quantile_1D</code><span class="sig-paren">(</span><em class="sig-param">data</em>, <em class="sig-param">weights</em>, <em class="sig-param">quantile</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.utils.quantile_1D" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the weighted quantile of a 1D numpy array.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<em>ndarray</em>) – Input array (one dimension).</p></li>
<li><p><strong>weights</strong> (<em>ndarray</em>) – Array with the weights of the same size of <cite>data</cite>.</p></li>
<li><p><strong>quantile</strong> (<em>float</em>) – Quantile to compute. It must have a value between 0 and 1.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>quantile_1D</strong> – The output value.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="rainforest.common.utils.read_df">
<code class="sig-prename descclassname">rainforest.common.utils.</code><code class="sig-name descname">read_df</code><span class="sig-paren">(</span><em class="sig-param">pattern</em>, <em class="sig-param">dbsystem='dask'</em>, <em class="sig-param">sqlContext=None</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.utils.read_df" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads a set of data contained in a folder as a spark or dask DataFrame</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>pattern</strong> (<em>str</em>) – Unix style wildcard pattern pointing to the files, for example
/store/msrad/folder/<a href="#id3"><span class="problematic" id="id4">*</span></a>.csv will read all csv files in that folder</p></li>
<li><p><strong>dbsystem</strong> (<em>str</em>) – Either “dask” if you want a Dask DataFrame or “spark” if you want a
spark dataframe</p></li>
<li><p><strong>sqlContext</strong> (<em>sqlContext instance</em>) – sqlContext to use, required only if dbystem = ‘spark’</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>A spark or dask DataFrame instance</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="rainforest.common.utils.read_task_file">
<code class="sig-prename descclassname">rainforest.common.utils.</code><code class="sig-name descname">read_task_file</code><span class="sig-paren">(</span><em class="sig-param">task_file</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.utils.read_task_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads a database processing task file</p>
</dd></dl>

<dl class="function">
<dt id="rainforest.common.utils.rename_fields">
<code class="sig-prename descclassname">rainforest.common.utils.</code><code class="sig-name descname">rename_fields</code><span class="sig-paren">(</span><em class="sig-param">data</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.utils.rename_fields" title="Permalink to this definition">¶</a></dt>
<dd><p>Rename pyart fields from pyrad names to simpler names, according to the
dictionary PYART_NAMES_MAPPING in the constants.py module</p>
</dd></dl>

<dl class="function">
<dt id="rainforest.common.utils.round_to_hour">
<code class="sig-prename descclassname">rainforest.common.utils.</code><code class="sig-name descname">round_to_hour</code><span class="sig-paren">(</span><em class="sig-param">dt</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.utils.round_to_hour" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the sweep number of a polar file based on its name</p>
</dd></dl>

<dl class="function">
<dt id="rainforest.common.utils.split_by_time">
<code class="sig-prename descclassname">rainforest.common.utils.</code><code class="sig-name descname">split_by_time</code><span class="sig-paren">(</span><em class="sig-param">files_rad</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.utils.split_by_time" title="Permalink to this definition">¶</a></dt>
<dd><p>Separate a list of files by their timestamp</p>
</dd></dl>

<dl class="function">
<dt id="rainforest.common.utils.stack_uneven">
<code class="sig-prename descclassname">rainforest.common.utils.</code><code class="sig-name descname">stack_uneven</code><span class="sig-paren">(</span><em class="sig-param">arrays</em>, <em class="sig-param">fill_value=nan</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.utils.stack_uneven" title="Permalink to this definition">¶</a></dt>
<dd><p>Fits mmltiple into a single numpy array, even if they are
different sizes, assigning a fill_value to parts with no data</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>arrays</strong> (<em>list of np arrays</em>) – list of numpy array to stack, they can have different dimensions</p></li>
<li><p><strong>fill_value</strong> (<em>(</em><em>float</em><em>, </em><em>optional</em><em>)</em>) – the fill value with which to fill the missing pixels</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>a np.ndarray with size N x M, where N is the sum of the number of</em></p></li>
<li><p><em>rows of all arrays and M is the maximal number of columns in all arrays</em></p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="rainforest.common.utils.sweepnumber_fromfile">
<code class="sig-prename descclassname">rainforest.common.utils.</code><code class="sig-name descname">sweepnumber_fromfile</code><span class="sig-paren">(</span><em class="sig-param">fname</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.utils.sweepnumber_fromfile" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the sweep number of a polar file based on its name</p>
</dd></dl>

<dl class="function">
<dt id="rainforest.common.utils.timefromfilename">
<code class="sig-prename descclassname">rainforest.common.utils.</code><code class="sig-name descname">timefromfilename</code><span class="sig-paren">(</span><em class="sig-param">fname</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.utils.timefromfilename" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the datetime of a file based on its name</p>
</dd></dl>

<dl class="function">
<dt id="rainforest.common.utils.timestamp_from_datestr">
<code class="sig-prename descclassname">rainforest.common.utils.</code><code class="sig-name descname">timestamp_from_datestr</code><span class="sig-paren">(</span><em class="sig-param">datestr</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.utils.timestamp_from_datestr" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="rainforest.common.utils.timestamp_from_datetime">
<code class="sig-prename descclassname">rainforest.common.utils.</code><code class="sig-name descname">timestamp_from_datetime</code><span class="sig-paren">(</span><em class="sig-param">dt</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.utils.timestamp_from_datetime" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="rainforest.common.utils.wgs84toCH1903">
<code class="sig-prename descclassname">rainforest.common.utils.</code><code class="sig-name descname">wgs84toCH1903</code><span class="sig-paren">(</span><em class="sig-param">lat</em>, <em class="sig-param">lon</em>, <em class="sig-param">heights</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.utils.wgs84toCH1903" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts a set of WGS84, lat/lon/heights to Swiss CH1903 coordinates,
east, north and height</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>lat</strong> (<em>ndarray</em>) – latitudes in decimal format (degrees)</p></li>
<li><p><strong>lon</strong> (<em>ndarray</em>) – longitudes in decimal format (degrees)</p></li>
<li><p><strong>heights</strong> (<em>ndarray</em>) – heights a.s.l in WGS84 coordinates</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>east, north and height coordinates in CHLV190</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-rainforest.common.wgs84_ch1903">
<span id="rainforest-common-wgs84-ch1903-module"></span><h2>rainforest.common.wgs84_ch1903 module<a class="headerlink" href="#module-rainforest.common.wgs84_ch1903" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="rainforest.common.wgs84_ch1903.GPSConverter">
<em class="property">class </em><code class="sig-prename descclassname">rainforest.common.wgs84_ch1903.</code><code class="sig-name descname">GPSConverter</code><a class="headerlink" href="#rainforest.common.wgs84_ch1903.GPSConverter" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>GPS Converter class which is able to perform convertions between the
CH1903 and WGS84 system.</p>
<dl class="method">
<dt id="rainforest.common.wgs84_ch1903.GPSConverter.CHtoWGSheight">
<code class="sig-name descname">CHtoWGSheight</code><span class="sig-paren">(</span><em class="sig-param">y</em>, <em class="sig-param">x</em>, <em class="sig-param">h</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.wgs84_ch1903.GPSConverter.CHtoWGSheight" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="rainforest.common.wgs84_ch1903.GPSConverter.CHtoWGSlat">
<code class="sig-name descname">CHtoWGSlat</code><span class="sig-paren">(</span><em class="sig-param">y</em>, <em class="sig-param">x</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.wgs84_ch1903.GPSConverter.CHtoWGSlat" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="rainforest.common.wgs84_ch1903.GPSConverter.CHtoWGSlng">
<code class="sig-name descname">CHtoWGSlng</code><span class="sig-paren">(</span><em class="sig-param">y</em>, <em class="sig-param">x</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.wgs84_ch1903.GPSConverter.CHtoWGSlng" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="rainforest.common.wgs84_ch1903.GPSConverter.DecToSexAngle">
<code class="sig-name descname">DecToSexAngle</code><span class="sig-paren">(</span><em class="sig-param">dec</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.wgs84_ch1903.GPSConverter.DecToSexAngle" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="rainforest.common.wgs84_ch1903.GPSConverter.LV03toWGS84">
<code class="sig-name descname">LV03toWGS84</code><span class="sig-paren">(</span><em class="sig-param">east</em>, <em class="sig-param">north</em>, <em class="sig-param">height</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.wgs84_ch1903.GPSConverter.LV03toWGS84" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert LV03 to WGS84 Return a array of double that contain lat, long,
and height</p>
</dd></dl>

<dl class="method">
<dt id="rainforest.common.wgs84_ch1903.GPSConverter.SexAngleToSeconds">
<code class="sig-name descname">SexAngleToSeconds</code><span class="sig-paren">(</span><em class="sig-param">dms</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.wgs84_ch1903.GPSConverter.SexAngleToSeconds" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="rainforest.common.wgs84_ch1903.GPSConverter.SexToDecAngle">
<code class="sig-name descname">SexToDecAngle</code><span class="sig-paren">(</span><em class="sig-param">dms</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.wgs84_ch1903.GPSConverter.SexToDecAngle" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="rainforest.common.wgs84_ch1903.GPSConverter.WGS84toLV03">
<code class="sig-name descname">WGS84toLV03</code><span class="sig-paren">(</span><em class="sig-param">latitude</em>, <em class="sig-param">longitude</em>, <em class="sig-param">ellHeight</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.wgs84_ch1903.GPSConverter.WGS84toLV03" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert WGS84 to LV03 Return an array of double that contaign east,
north, and height</p>
</dd></dl>

<dl class="method">
<dt id="rainforest.common.wgs84_ch1903.GPSConverter.WGStoCHh">
<code class="sig-name descname">WGStoCHh</code><span class="sig-paren">(</span><em class="sig-param">lat</em>, <em class="sig-param">lng</em>, <em class="sig-param">h</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.wgs84_ch1903.GPSConverter.WGStoCHh" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="rainforest.common.wgs84_ch1903.GPSConverter.WGStoCHx">
<code class="sig-name descname">WGStoCHx</code><span class="sig-paren">(</span><em class="sig-param">lat</em>, <em class="sig-param">lng</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.wgs84_ch1903.GPSConverter.WGStoCHx" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="rainforest.common.wgs84_ch1903.GPSConverter.WGStoCHy">
<code class="sig-name descname">WGStoCHy</code><span class="sig-paren">(</span><em class="sig-param">lat</em>, <em class="sig-param">lng</em><span class="sig-paren">)</span><a class="headerlink" href="#rainforest.common.wgs84_ch1903.GPSConverter.WGStoCHy" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../examples.html" class="btn btn-neutral float-right" title="Examples" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="rainforest.ml.html" class="btn btn-neutral float-left" title="rainforest.ml package" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Daniel Wolfensherger

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>